<!DOCTYPE html>
<html lang="ja">
<head>
<script src="https://e24028.github.io/Random.js"></script>
<title>円周率暗記ソフト</title>
<style>
html
{
    height: 100%;
}

body
{
    height: calc(100% - 16px);
}

.container
{
    display: flex;
}

span
{
    margin-right: 2px;
}

input
{
    text-align: center;
    width: 100px;
    height: 20px;
    margin-right: 2px;
}

#submitButton
{
    background-color: lightgreen;
    border: 3px solid green;
    border-radius: 6px;
    width: 60px;
    text-align: center;
    margin-right: 2px;
    cursor: pointer;
}

b
{
    margin: 0px;
}

.inner
{
    width: 100%;
    min-width: 65px;
    height: 25px;
    border: 1px solid blue;
    background-color: lightblue;
    text-align: center;
    overflow: auto;
}

#HISTORY
{
    /* min-width: 260px; */
    width: 100%;
    height: auto;
}

#leftBox, #rightBox
{
    width: 100%;
    height: 100%;
    overflow: auto;
    white-space: nowrap;
}

#main
{
    zoom: 180%;
    height: 100%;
}
</style>
</head>
<body onload="next()" onkeypress="S(event)">
<div id="main">
    <div class="container" style="height: 100%;">
        <div id="leftBox" title="左画面">
            <div title="タイトル">
                <b>円周率暗記ソフト</b>
            </div>

            <div title="ステータス1">
                <span>レベル</span>
                <span id="LEVEL"></span>
                <span>[</span>
                <span id="MIN"></span>
                <span>～</span>
                <span id="MAX"></span>
                <span>]</span>
                <span>:</span>
                <span>残り</span>
                <span id="TIME"></span>
                <span>問</span>
            </div>

            <div title="問題">
                <span id="question"></span>
                <span>× 3.14 =</span>
                <input type="number" id="input" oninput="submitable()" title="入力">
                <button id="submitButton" onclick="submit()" title="回答"></button>
                <span id="result"></span>
            </div>

            <div title="ステータス2">
                <span>正解</span>
                <span>:</span>
                <span id="RIGHT"></span>
                <span>/</span>
                <span id="ALL"></span>
                <span>問</span>
                <span>(</span>
                <span id="DIVIDE"></span>
                <span>%</span>
                <span>)</span>
            </div>

            <div title="履歴 →">
                <span>履歴</span>
                <span>→</span>
            </div>
        </div>
        <div id="rightBox" title="右画面">
            <div id="HISTORY"></div>
        </div>
    </div>
</div>
<script>
var Q = document.getElementById('question');
var Input = document.getElementById('input');
var button = document.getElementById('submitButton');
var Result = document.getElementById('result');

var LEVEL = document.getElementById('LEVEL');
var MIN = document.getElementById('MIN');
var MAX = document.getElementById('MAX');
var TIME = document.getElementById('TIME');
var RIGHT = document.getElementById('RIGHT');
var ALL = document.getElementById('ALL');
var DIVIDE = document.getElementById('DIVIDE');
var HISTORY = document.getElementById('HISTORY');

var nQ = Number(Q.innerText);
var nI = Number(Input.value);
var n = round(nQ * 3.14);

var min = 1;
var max = 10;
var time = 5;
var right = 0;
var all = 0;
var divide = '----';
var result = '';

function submit()
{
    nQ = Number(Q.innerText);
    nI = Number(Input.value);
    n = round(nQ * 3.14);

    result = (n === nI);
    if (result)
    {
        setResult('正解！', 'green');

        right++;
    } else {
        setResult(`間違い... 正解は ${n}`, 'red');
    }

    all++;
    divide = round((right / all) * 100);

    input.disabled = 'true';
    button.innerText = '次へ';
    button.onclick = next;

    time -= 1;

    if (time == 0)
    {
        min += 10;
        max += 10;
        time = 5;
    }
}

function S(event)
{
    if ((event.key === 'Enter' || event.keyCode === 13) && Input.value != '')
    {
        button.click();
    }
}

function setResult(text, color)
{
    Result.innerText = text;
    Result.style.color = color;
}

function next()
{
    var historyElement = document.createElement('div');
    historyElement.classList.add('container');
    // historyElement.style.height = '20px';

    if (all != 0)
    {
        historyElement.setAttribute('title', `${all + 1} 行目`);

        if (result)
        {
            historyElement.innerHTML = `
            <div class="inner">${all}</div>
            <div class="inner">正解</div>
            <div class="inner">${nQ} π</div>
            <div class="inner">${n}</div>
            <div class="inner">${nI}</div>
            `;
        } else {
            historyElement.innerHTML = `
            <div class="inner">${all}</div>
            <div class="inner">不正解</div>
            <div class="inner">${nQ} π</div>
            <div class="inner">${n}</div>
            <div class="inner">${nI}</div>
            `;
        }
    } else {
        historyElement.setAttribute('title', '見出し');

        historyElement.innerHTML = `
        <div class="inner">問題番号</div>
        <div class="inner">結果</div>
        <div class="inner">問題</div>
        <div class="inner">正解</div>
        <div class="inner">回答</div>
        `;
    }

    HISTORY.appendChild(historyElement);

    Q.innerText = getRandom(min, max);
    MIN.innerText = min;
    MAX.innerText = max;
    LEVEL.innerText = (max / 10);
    TIME.innerText = time;
    RIGHT.innerText = right;
    ALL.innerText = all;
    DIVIDE.innerText = divide;

    input.disabled = '';
    input.value = '';
    button.innerText = '回答';
    button.onclick = submit;

    setResult('', '');
    submitable();
}

function submitable()
{
    button.disabled = (Input.value === '');
}

function round(n)
{
    const n100 = Math.round(n * 100);
    return (n100 / 100);
}
</script>
</body>
</html>
